<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>lemueIO SecMonitor</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/assets/hfish-ui.1.2.12.css" />
    <style type="text/css">
        .main-loading-wrap {
            text-align: center;
            margin-top: 100px;
            color: rgba(17, 18, 34, 0.6);
            font-size: 12px;
        }

        .lds-dual-ring {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin-bottom: 10px;
        }

        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 24px;
            height: 24px;
            margin: 8px;
            border-radius: 50%;
            border: 2px solid rgba(17, 18, 34, 0.8);
            border-color: rgba(17, 18, 34, 0.8) transparent rgba(17, 18, 34, 0.8) transparent;
            animation: lds-dual-ring 1.2s linear infinite;
            animation: lds-dual-ring 1.2s linear infinite;
        }

        @keyframes lds-dual-ring {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- <link rel="stylesheet" href="/styles/index.css"> -->
    <script type="text/javascript">
        if (!('remove' in Element.prototype)) {
            Element.prototype.remove = function () {
                if (this.parentNode) {
                    this.parentNode.removeChild(this);
                }
            };
        }
    </script>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <script>
        console.log("%c [HoneyScan] Injecting Active Defense Interceptors (v2)...", "color: #4ade80; font-weight: bold;");

        // === WEBSOCKET INTERCEPTOR ===
        (function () {
            const OriginalWebSocket = window.WebSocket;
            window.WebSocket = function (url, protocols) {
                console.log("[HoneyScan] WebSocket Connect: " + url);
                const ws = new OriginalWebSocket(url, protocols);

                // Intercept incoming messages
                const originalAddEventListener = ws.addEventListener;
                ws.addEventListener = function (type, listener, options) {
                    if (type === 'message') {
                        const wrappedListener = function (event) {
                            if (typeof event.data === 'string' && event.data.includes('23.88.40.46')) {
                                console.log("[HoneyScan] WS HIT! Found Node IP in message.");
                                // Attempt to patch if it's JSON
                                try {
                                    let data = JSON.parse(event.data);
                                    // Recursive Patch
                                    let patched = false;
                                    const patchNode = (obj) => {
                                        if (!obj || typeof obj !== 'object') return;
                                        if (obj.ip === '23.88.40.46' || obj.intranet_ip === '23.88.40.46') {
                                            obj.country = 'Germany';
                                            obj.city = 'Falkenstein';
                                            obj.province = 'Saxony';
                                            obj.lat = 50.4777;
                                            obj.lng = 12.3649;
                                            obj.latitude = 50.4777;
                                            obj.longitude = 12.3649;
                                            patched = true;
                                        }
                                        for (let key in obj) {
                                            if (typeof obj[key] === 'object') patchNode(obj[key]);
                                        }
                                    };
                                    patchNode(data);

                                    if (patched) {
                                        console.log("[HoneyScan] WS Patched!");
                                        // Create new event with patched data
                                        const newEvent = new MessageEvent('message', {
                                            data: JSON.stringify(data),
                                            origin: event.origin,
                                            lastEventId: event.lastEventId,
                                            source: event.source,
                                            ports: event.ports
                                        });
                                        listener.call(this, newEvent);
                                        return; // Stop original listener from seeing bad data? 
                                        // Actually, we are wrapping the listener passed by the app.
                                        // So calling listener(newEvent) is correct.
                                    }
                                } catch (e) { console.error("WS Patch Error", e); }
                            }
                            listener.call(this, event);
                        };
                        return originalAddEventListener.call(this, type, wrappedListener, options);
                    }
                    return originalAddEventListener.call(this, type, listener, options);
                };

                // Also hook 'onmessage' property
                Object.defineProperty(ws, 'onmessage', {
                    set: function (handler) {
                        this._onmessage = handler;
                        this.addEventListener('message', handler);
                        // Note: varying implementations of onmessage vs addEventListener might conflict, 
                        // but this is a best-effort patch.
                    },
                    get: function () { return this._onmessage; }
                });

                return ws;
            };
            window.WebSocket.prototype = OriginalWebSocket.prototype;
            window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
            window.WebSocket.OPEN = OriginalWebSocket.OPEN;
            window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
            window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;
        })();

        // === FETCH INTERCEPTOR ===
        (function () {
            const originalFetch = window.fetch;
            window.fetch = async function (...args) {
                // Log URL
                let url = args[0];
                if (typeof url !== 'string' && url.url) url = url.url; // Request object

                if (url && (url.includes('api') || url.includes('node'))) {
                    console.log("[HoneyScan] Fetch: " + url);
                }

                const response = await originalFetch(...args);
                try {
                    const respUrl = response.url;
                    if (respUrl.includes('api/v1/dashboard') || respUrl.includes('api/v1/attack') || respUrl.includes('node')) {
                        const clone = response.clone();
                        const text = await clone.text();
                        if (text && text.includes('23.88.40.46')) {
                            console.log("[HoneyScan] Fetch HIT! Found Node IP in: " + respUrl);
                            let data = JSON.parse(text);
                            let patched = false;
                            const patchNode = (obj) => {
                                if (!obj || typeof obj !== 'object') return;
                                if (obj.ip === '23.88.40.46' || obj.intranet_ip === '23.88.40.46') {
                                    obj.country = 'Germany';
                                    obj.city = 'Falkenstein';
                                    obj.province = 'Saxony';
                                    obj.lat = 50.4777;
                                    obj.lng = 12.3649;
                                    obj.latitude = 50.4777;
                                    obj.longitude = 12.3649;
                                    patched = true;
                                }
                                for (let key in obj) {
                                    if (typeof obj[key] === 'object') patchNode(obj[key]);
                                }
                            };
                            patchNode(data);
                            if (patched) {
                                console.log("[HoneyScan] Fetch Patched!");
                                const newText = JSON.stringify(data);
                                return new Response(newText, {
                                    status: response.status,
                                    statusText: response.statusText,
                                    headers: response.headers
                                });
                            }
                        }
                    }
                } catch (e) { console.error("HoneyScan Fetch Interceptor Error:", e); }
                return response;
            };
        })();

        // === XHR INTERCEPTOR ===
        (function () {
            const XHR = XMLHttpRequest.prototype;
            const open = XHR.open;
            const send = XHR.send;
            XHR.open = function (method, url) {
                this._url = url;
                if (url.includes('api') || url.includes('node')) {
                    console.log("[HoneyScan] XHR Open: " + url);
                }
                return open.apply(this, arguments);
            };
            XHR.send = function (postData) {
                this.addEventListener('readystatechange', function () {
                    if (this.readyState === 4 && this.status === 200 && this._url) {
                        try {
                            const url = this._url;
                            if (url.includes('api/v1/dashboard') || url.includes('api/v1/attack') || url.includes('node')) {
                                let text = this.responseText;
                                if (text && text.includes('23.88.40.46')) {
                                    console.log("[HoneyScan] XHR HIT! Found Node IP in: " + url);
                                    let data = JSON.parse(text);
                                    let patched = false;
                                    const patchNode = (obj) => {
                                        if (!obj || typeof obj !== 'object') return;
                                        if (obj.ip === '23.88.40.46' || obj.intranet_ip === '23.88.40.46') {
                                            obj.country = 'Germany';
                                            obj.city = 'Falkenstein';
                                            obj.province = 'Saxony';
                                            obj.lat = 50.4777;
                                            obj.lng = 12.3649;
                                            obj.latitude = 50.4777;
                                            obj.longitude = 12.3649;
                                            patched = true;
                                        }
                                        for (let key in obj) {
                                            if (typeof obj[key] === 'object') patchNode(obj[key]);
                                        }
                                    };
                                    patchNode(data);
                                    if (patched) {
                                        console.log("[HoneyScan] XHR Patched!");
                                        const newText = JSON.stringify(data);
                                        Object.defineProperty(this, 'responseText', { value: newText, writable: true });
                                        Object.defineProperty(this, 'response', { value: newText, writable: true });
                                    }
                                }
                            }
                        } catch (e) { console.error("HoneyScan XHR Interceptor Error:", e); }
                    }
                });
                return send.apply(this, arguments);
            };
        })();
    </script>
</head>

<body>
    <div id="app">
        <div class="main-loading-wrap">
            <div class="spinner-wrapper">
                <div class="lds-dual-ring"></div>
                <div class="spinner-txt">加载中...</div>
            </div>
        </div>
    </div>
    <script>
        __REACT_DEVTOOLS_GLOBAL_HOOK__ = parent.__REACT_DEVTOOLS_GLOBAL_HOOK__;
    </script>
    <script type="text/javascript" defer src="/assets/flags/svgxuse.min.js"></script>
    <script type="text/javascript" src="/assets/dllSelf.09a1636445d39f4f9ec3.js"></script>
    <script type="text/javascript" src="/assets/app.6539b5af.js"></script>
    <script>
        // Branding Configuration
        const BRAND_TITLE = "Honey Scan Active Defense";
        const LOGO_PATH = '/assets/logo_bear.png';

        const patchBrandingAggressive = () => {
            // Global: Keep Title Consistent
            if (document.title !== "lemueIO SecMonitor") {
                document.title = "lemueIO SecMonitor";
            }

            // === UNIVERSAL TEXT REPLACEMENT (Runs everywhere) ===
            // This fixes "XX Company Threat Monitor" on the dashboard
            const replaceTextContent = (selector, target, replacement) => {
                try {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        // Safety: Check if innerText exists
                        if (!el.innerText) return;

                        // CRITICAL: Only replace text in LEAF nodes (no children) to avoid destroyed React/Vue bindings
                        // replacing innerHTML on a container (like #app or a parent div) kills the application.
                        if (el.children.length === 0 && el.innerText.includes(target) && !el.dataset.branded) {
                            el.innerText = el.innerText.replace(target, replacement);
                            el.dataset.branded = 'true';
                        }
                    });
                } catch (e) { console.error('Branding patch error:', e); }
            };

            // Specific HFish Dashboard Elements
            // Use specific tags instead of '*' to improve performance and safety
            const textTags = 'div, span, h1, h2, h3, h4, h5, p, li, a, td, th';
            replaceTextContent(textTags, 'XX Company Threat Monitor', 'lemueIO SecMonitor');
            replaceTextContent(textTags, 'HFish Attack Map', 'lemueIO SecMonitor');
            replaceTextContent(textTags, 'HFish Statistics', 'lemueIO Statistics');
            replaceTextContent(textTags, 'Live Threat Monitor', 'lemueIO Active Intelligence Feed');

            // Route Detection: Only apply aggressive layout changes on Login Page
            const isLogin = location.href.includes('/login') || location.hash.includes('login');

            if (isLogin) {
                // === LOGIN PAGE LOGIC ===

                // 1. Logo Replacement (Left Side - SVG Wrapper)
                const leftWrapper = document.querySelector('div[class*="left-wrapper"]');
                if (leftWrapper) {
                    const svgs = leftWrapper.querySelectorAll('svg');
                    svgs.forEach(svg => {
                        if (svg.innerHTML.includes('#hfish') || svg.innerHTML.includes('hfish')) {
                            const container = svg.parentElement;
                            if (container && !container.dataset.patched && !container.querySelector('input')) {
                                container.innerHTML = '';
                                const newLogo = document.createElement('img');
                                newLogo.src = LOGO_PATH;
                                newLogo.style.maxWidth = '100%';
                                newLogo.style.height = 'auto';
                                container.appendChild(newLogo);
                                container.dataset.patched = 'true';
                            }
                        }
                    });
                }

                // 2. Central Branding Replacement (SVG -> HTML)
                const rightWrapper = document.querySelector('div[class*="right-wrapper"]');
                if (rightWrapper) {
                    const brandSvgs = rightWrapper.querySelectorAll('svg');
                    brandSvgs.forEach(svg => {
                        if (svg.innerHTML.includes('hfish') || svg.getAttribute('class')?.includes('onefish-logo')) {
                            if (!svg.dataset.patched) {
                                const container = document.createElement('div');
                                container.style.textAlign = 'center';
                                container.style.marginBottom = '20px';
                                container.style.display = 'flex';
                                container.style.flexDirection = 'column';
                                container.style.alignItems = 'center';
                                container.style.justifyContent = 'center';

                                const title = document.createElement('div');
                                title.innerText = "Honey Scan";
                                title.style.color = "#4ade80";
                                title.style.fontSize = "36px";
                                title.style.fontWeight = "900";
                                title.style.fontFamily = "sans-serif";
                                title.style.letterSpacing = "1px";
                                title.style.marginBottom = "8px";
                                title.style.lineHeight = "1.2";

                                const pill = document.createElement('div');
                                pill.innerText = "Active Defense Platform";
                                pill.style.backgroundColor = "rgba(255, 255, 255, 0.1)";
                                pill.style.color = "rgba(255, 255, 255, 0.8)";
                                pill.style.padding = "4px 12px";
                                pill.style.borderRadius = "12px";
                                pill.style.fontSize = "14px";
                                pill.style.fontWeight = "500";
                                pill.style.display = "inline-block";

                                container.appendChild(title);
                                container.appendChild(pill);

                                svg.replaceWith(container);
                                container.dataset.patched = 'true';
                            }
                        }
                    });
                }

                // 3. Inject "Nuclear" CSS for Login Only
                if (!document.getElementById('branding-style')) {
                    const style = document.createElement('style');
                    style.id = 'branding-style';
                    style.innerHTML = `
                      /* LOGIN PAGE ONLY STYLES */
                      html, body {
                          background-color: #0f172a !important; /* Cyber Dark */
                          margin: 0 !important;
                          padding: 0 !important;
                          overflow-x: hidden !important;
                      }

                      /* HIDE ORIGINAL HEADER ONLY */
                      div[class*="header"], header, .el-header, .header-wrapper, nav, section[class*="header"], 
                      .screen-header-left-title, .screen-title,
                      div[class*="top"], .el-card__header {
                          display: none !important;
                          opacity: 0 !important;
                          visibility: hidden !important;
                          height: 0 !important;
                          width: 0 !important;
                          padding: 0 !important;
                          margin: 0 !important;
                          border: none !important;
                          overflow: hidden !important;
                      }
                      
                      div[class*="header"] * { display: none !important; }

                      /* Fix Title Spacing */
                      div[class*="index-cssmodule__login-wrapper"], .login-container, .login-box {
                          margin-top: 10px !important; 
                      }
                      
                      /* Login Button Green */
                      div[class*="index-cssmodule__btn"], button[class*="index-cssmodule__btn"], .el-button--primary {
                          background-color: #4ade80 !important;
                          border-color: #4ade80 !important;
                          color: #0f172a !important; 
                          font-weight: bold !important;
                      }
                      div[class*="index-cssmodule__btn"]:hover, button[class*="index-cssmodule__btn"]:hover, .el-button--primary:hover {
                          background-color: #22c55e !important;
                          border-color: #22c55e !important;
                      }
                      
                      /* Footer IPv6 Button Green */
                      .index-cssmodule__ipv6-1nOCE {
                          background-color: #4ade80 !important;
                          color: #ffffff !important; 
                          font-weight: bold !important; 
                          border-color: #4ade80 !important; 
                          border: 1px solid #4ade80 !important;
                      }

                      /* Logo Padding For Clip Fix */
                      img[src*="logo_bear.png"] {
                          width: 80% !important; 
                          max-width: 350px !important;
                          display: block;
                          margin: 0 auto;
                          padding: 15px !important; 
                          box-sizing: border-box !important;
                          aspect-ratio: 1 / 1 !important; 
                          object-fit: contain !important; 
                          height: auto !important;
                      }
                      
                      /* Custom Footer */
                      #lemue-footer {
                          position: fixed;
                          bottom: 10px;
                          width: 100%;
                          text-align: center;
                          color: rgba(255, 255, 255, 0.5);
                          font-size: 12px;
                          pointer-events: none;
                          z-index: 9999;
                      }

                      /* Top Right Link Bar - FLUSH TOP (0px) */
                      #lemue-link-bar {
                          position: fixed;
                          top: 0;
                          right: 0;
                          display: flex;
                          gap: 15px;
                          z-index: 10000;
                          background: rgba(0, 0, 0, 0.4);
                          padding: 8px 20px;
                          border-bottom-left-radius: 15px;
                          backdrop-filter: blur(5px);
                      }
                      .lemue-link {
                          display: flex;
                          align-items: center;
                          justify-content: center;
                          width: 24px;
                          height: 24px;
                          opacity: 0.7;
                          transition: opacity 0.2s;
                          color: #4ade80;
                      }
                      .lemue-link:hover {
                          opacity: 1;
                      }
                      .lemue-link svg {
                          width: 100%;
                          height: 100%;
                          fill: currentColor;
                      }
                      .lemue-link img {
                          width: 100%;
                          height: 100%;
                          border-radius: 50%;
                      }
                    `;
                    document.head.appendChild(style);
                }

                // 4. Inject Footer
                if (!document.getElementById('lemue-footer')) {
                    const footer = document.createElement('div');
                    footer.id = 'lemue-footer';
                    footer.innerHTML = 'for you by lemue.org ♥️';
                    document.body.appendChild(footer);
                }

                // 5. Inject Link Bar
                if (!document.getElementById('lemue-link-bar')) {
                    const linkBar = document.createElement('div');
                    linkBar.id = 'lemue-link-bar';

                    const links = [
                        {
                            href: 'https://github.com/derlemue/honey-scan',
                            icon: '<svg viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>',
                            title: 'GitHub'
                        },
                        {
                            href: 'https://feed.sec.lemue.org/',
                            icon: '<svg viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg>',
                            title: 'Feed'
                        },
                        {
                            href: 'https://feed.sec.lemue.org/feed/banned_ips.txt',
                            icon: '<svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>',
                            title: 'Banned IPs'
                        },
                        {
                            href: 'https://lemue.org',
                            icon: '<img src="https://lemue.org/favicon.ico" alt="lemue.org" onerror="this.style.display=\'none\'">',
                            title: 'lemue.org'
                        }
                    ];

                    links.forEach(link => {
                        const a = document.createElement('a');
                        a.href = link.href;
                        a.className = 'lemue-link';
                        a.target = '_blank';
                        a.innerHTML = link.icon;
                        a.title = link.title;
                        linkBar.appendChild(a);
                    });

                    document.body.appendChild(linkBar);
                }

            } else {
                // === DASHBOARD / OTHER PAGES LOGIC ===
                // CLEANUP "Nuclear" styles to restore original UI

                // Remove CSS Overrides (Restores Header, Background, etc.)
                const style = document.getElementById('branding-style');
                if (style) style.remove();

                // Remove Link Bar (Only for Login)
                const linkBar = document.getElementById('lemue-link-bar');
                if (linkBar) linkBar.remove();

                // Remove Footer (Only for Login)
                const footer = document.getElementById('lemue-footer');
                if (footer) footer.remove();
            }

            // Always Inject Favicons (Safe to check continuously)
            const addFavicon = (rel, href, sizes) => {
                if (!document.querySelector(`link[href="${href}"]`)) {
                    let link = document.createElement('link');
                    link.rel = rel;
                    link.href = href;
                    if (sizes) link.sizes = sizes;
                    document.head.appendChild(link);
                }
            };
            // Only clean up defaults once really
            if (!window.faviconsPatched) {
                document.querySelectorAll('link[rel="shortcut icon"]').forEach(e => e.remove());
                window.faviconsPatched = true;
            }

            addFavicon('icon', '/assets/favicon.ico');
            addFavicon('icon', '/assets/favicon-32x32.png', '32x32');
            addFavicon('icon', '/assets/favicon-16x16.png', '16x16');
            addFavicon('apple-touch-icon', '/assets/apple-touch-icon.png');
        };

        // Run aggressively
        patchBrandingAggressive();
        setInterval(patchBrandingAggressive, 200);

        // === DATA PATCHING (Timezone & Flags) ===
        const patchDataIssues = () => {
            try {
                // 1. TIMEZONE FIX (+1 Hour for CET Correction from "Server Time")
                // User reported -1h error. Previous patch was +2h. Reducing to +1h (3600000ms).
                const timeElements = document.querySelectorAll('p[class*="time"], span[class*="time"]');
                timeElements.forEach(el => {
                    if (el.dataset.timePatched) return;

                    const text = el.innerText.trim();
                    // Regex for YYYY/MM/DD HH:mm:ss
                    if (/^\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}:\d{2}$/.test(text)) {
                        const dateStr = text.replace(/\//g, '-');
                        let date = new Date(dateStr);

                        if (!isNaN(date.getTime())) {
                            // Add 1 Hour (3600000 ms)
                            date.setTime(date.getTime() + 3600000);

                            // Format back to YYYY/MM/DD HH:mm:ss
                            const pad = (n) => n.toString().padStart(2, '0');
                            const newText = `${date.getFullYear()}/${pad(date.getMonth() + 1)}/${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;

                            el.innerText = newText;
                            el.dataset.timePatched = 'true';
                        }
                    }
                });

                // 2. FLAG FIX (Map Name -> SVG Class)
                // Target generic rows in recent attacks by finding the flag icon first
                const flagSvgs = document.querySelectorAll('svg.flag-icon');
                flagSvgs.forEach(svg => {
                    // Check if it's the broken default one
                    const useHref = svg.querySelector('use');
                    if (!useHref || !useHref.getAttribute('xlink:href').includes('flagdefault')) return;

                    // The country name is usually in the NEXT SIBLING span
                    const countrySpan = svg.nextElementSibling;
                    if (!countrySpan || countrySpan.tagName !== 'SPAN') return;

                    const country = countrySpan.innerText.trim();

                    // Map Country Name to ISO Code (Expanded List)
                    const countryMap = {
                        'China': 'cn', 'United States': 'us', 'Germany': 'de', 'France': 'fr',
                        'Russia': 'ru', 'United Kingdom': 'gb', 'Netherlands': 'nl', 'Brazil': 'br',
                        'India': 'in', 'Canada': 'ca', 'Korea': 'kr', 'Japan': 'jp', 'Vietnam': 'vn',
                        'Italy': 'it', 'Spain': 'es', 'Australia': 'au', 'Taiwan': 'tw', 'Singapore': 'sg',
                        'Nigeria': 'ng', 'Sweden': 'se', 'Poland': 'pl', 'Iran': 'ir', 'Turkey': 'tr',
                        'Romania': 'ro', 'Ukraine': 'ua', 'Mexico': 'mx', 'Argentina': 'ar', 'Ireland': 'ie',
                        'Austria': 'at', 'Switzerland': 'ch', 'Belgium': 'be', 'Denmark': 'dk', 'Norway': 'no',
                        'Finland': 'fi', 'Portugal': 'pt', 'Greece': 'gr', 'Czech Republic': 'cz', 'Hungary': 'hu',
                        'Indonesia': 'id', 'Thailand': 'th', 'Malaysia': 'my', 'Philippines': 'ph', 'South Africa': 'za',
                        'Egypt': 'eg', 'Israel': 'il', 'Slovakia': 'sk', 'Bulgaria': 'bg', 'Saudi Arabia': 'sa',
                        'United Arab Emirates': 'ae', 'Colombia': 'co', 'Chile': 'cl', 'Peru': 'pe', 'Pakistan': 'pk',
                        'Bangladesh': 'bd', 'New Zealand': 'nz', 'Hong Kong': 'hk'
                    };

                    const code = countryMap[country];
                    if (code) {
                        // Update Use Href
                        useHref.setAttribute('xlink:href', `#hfish-flag-${code}`);

                        // Also add the specific class if it helps styling
                        svg.classList.remove('undefined');
                        svg.classList.add(`flag-icon-${code}`);
                    }
                });

            } catch (e) { console.error('Data patch error:', e); }
        };

        setInterval(patchDataIssues, 1000); // Run every second to catch new rows
    </script>
</body>

</html>