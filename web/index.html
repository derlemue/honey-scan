<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>lemueIO SecMonitor</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="/assets/hfish-ui.1.2.12.css" />
  <style type="text/css">
    .main-loading-wrap {
      text-align: center;
      margin-top: 100px;
      color: rgba(17, 18, 34, 0.6);
      font-size: 12px;
    }

    .lds-dual-ring {
      display: inline-block;
      width: 30px;
      height: 30px;
      margin-bottom: 10px;
    }

    .lds-dual-ring:after {
      content: " ";
      display: block;
      width: 24px;
      height: 24px;
      margin: 8px;
      border-radius: 50%;
      border: 2px solid rgba(17, 18, 34, 0.8);
      border-color: rgba(17, 18, 34, 0.8) transparent rgba(17, 18, 34, 0.8) transparent;
      animation: lds-dual-ring 1.2s linear infinite;
      animation: lds-dual-ring 1.2s linear infinite;
    }

    @keyframes lds-dual-ring {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
  <!-- <link rel="stylesheet" href="/styles/index.css"> -->
  <script type="text/javascript">
    if (!('remove' in Element.prototype)) {
      Element.prototype.remove = function () {
        if (this.parentNode) {
          this.parentNode.removeChild(this);
        }
      };
    }

    // PERMANENT BRANDING & ASSET FIX
    // WRAPPED IN DOMContentLoaded TO PREVENT 'document.body is null' ERROR
    window.addEventListener('DOMContentLoaded', () => {
      try {
        const BRAND_TITLE = "lemueIO SecMonitor";
        const OLD_TITLE_TEXT = "XX Company Threat Monitor";

        // 1. Force Document Title (Aggressive)
        const forceTitle = () => {
          if (document.title !== BRAND_TITLE) {
            document.title = BRAND_TITLE;
          }
        };
        forceTitle();
        // Observer
        new MutationObserver(forceTitle).observe(document.querySelector('title'), { subtree: true, characterData: true, childList: true });
        // Interval fallback
        setInterval(forceTitle, 1000);

        // 2. Inject Flag Icons (Fixes '?' issue)
        fetch('/assets/flags.svg')
          .then(r => r.text())
          .then(svgContent => {
            const div = document.createElement('div');
            div.style.display = 'none';
            div.innerHTML = svgContent;

            // Rewrite IDs to match HFish
            const symbols = div.querySelectorAll('symbol');
            symbols.forEach(sym => {
              const countryCode = sym.id.replace('flag-', '');
              const newId = 'icon-' + countryCode;
              // Avoid duplicate IDs
              if (!document.getElementById(newId)) {
                const clone = sym.cloneNode(true);
                clone.id = newId;
                div.querySelector('svg').appendChild(clone);
              }
            });
            if (document.body) {
              document.body.insertBefore(div, document.body.firstChild);
            }
          }).catch(e => console.error("Flag injection failed", e));

        // 3. Text Replacement & CSS Injection
        const style = document.createElement('style');
        style.innerHTML = `
              .screen-header-left-title, .screen-title { 
                  visibility: hidden !important; 
                  position: relative !important;
              }
              .screen-header-left-title::after, .screen-title::after {
                  visibility: visible !important;
                  content: "${BRAND_TITLE}" !important;
                  position: absolute !important;
                  left: 0 !important;
                  top: 0 !important;
                  color: #fff !important; 
              }
            `;
        document.head.appendChild(style);

        const replaceBranding = () => {
          if (!document.body) return;
          const treeWalker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
          while (treeWalker.nextNode()) {
            const node = treeWalker.currentNode;
            if (node.nodeValue.includes(OLD_TITLE_TEXT)) {
              node.nodeValue = node.nodeValue.replace(OLD_TITLE_TEXT, BRAND_TITLE);
            }
            if (node.nodeValue.includes("HFish")) {
              node.nodeValue = node.nodeValue.replace("HFish", "lemueIO SecMonitor");
            }
          }
        };

        setInterval(replaceBranding, 500);
      } catch (e) {
        console.error("Critical Branding Script Error:", e);
      }
    }); 
  </script>
  <link rel="shortcut icon" href="/assets/favicon.ico">
</head>

<body>
  <div id="app">
    <div class="main-loading-wrap">
      <div class="spinner-wrapper">
        <div class="lds-dual-ring"></div>
        <div class="spinner-txt">加载中...</div>
      </div>
    </div>
  </div>
  <script>
    __REACT_DEVTOOLS_GLOBAL_HOOK__ = parent.__REACT_DEVTOOLS_GLOBAL_HOOK__;
  </script>
  <script>
    // --- Advanced Interceptor for Flags & Location ---
    (function () {
      // Prevent multiple injections
      if (window.__SecMonitorIntercepted) return;
      window.__SecMonitorIntercepted = true;

      console.log("%c [SecMonitor] Initializing API Interceptors...", "color: cyan; font-weight: bold;");

      const COUNTRY_MAP = {
        "United States": "us", "USA": "us", "America": "us",
        "China": "cn", "CN": "cn",
        "Germany": "de", "Deutschland": "de",
        "Great Britain": "gb", "Britain": "gb", "UK": "gb", "United Kingdom": "gb",
        "Russia": "ru", "Russian Federation": "ru",
        "Netherlands": "nl", "The Netherlands": "nl",
        "France": "fr",
        "Canada": "ca",
        "India": "in",
        "Japan": "jp",
        "South Korea": "kr", "Korea": "kr", "Republic of Korea": "kr",
        "Australia": "au",
        "Vietnam": "vn", "Viet Nam": "vn",
        "Indonesia": "id",
        "Brazil": "br", "Brasil": "br",
        "Italy": "it",
        "Lithuania": "lt",
        "Singapore": "sg",
        "Spain": "es",
        "Poland": "pl",
        "Sweden": "se",
        "Ukraine": "ua",
        "Romania": "ro",
        "Unknown": "unknown"
      };

      const originalXHR = window.XMLHttpRequest;

      function newXHR() {
        const xhr = new originalXHR();

        const originalOpen = xhr.open;
        xhr.open = function (method, url) {
          this._url = url;
          return originalOpen.apply(this, arguments);
        };

        const originalResponseTextDescriptor = Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype, 'responseText');
        Object.defineProperty(xhr, 'responseText', {
          get: function () {
            let originalText = "";
            try {
              originalText = originalResponseTextDescriptor.get.call(this);
            } catch (e) { return ""; }

            if (this._url && originalText) {
              try {
                // 1. Fix Missing Flags in "Recent Attacks" (/v1/index/latest_info)
                if (this._url.indexOf('/v1/index/latest_info') !== -1) {
                  const data = JSON.parse(originalText);
                  if (data && data.data) {
                    data.data.forEach(item => {
                      if (!item.source_ip_country_no) {
                        const name = item.source_ip_country_name_en;
                        // Fuzzy lookup
                        let code = COUNTRY_MAP[name] || COUNTRY_MAP[name.split(' ')[0]];
                        if (code) {
                          item.source_ip_country_no = code;
                        }
                      }
                      // Specific Override
                      if (item.source_ip_country_name_en === "Netherlands") item.source_ip_country_no = "nl";
                      if (item.source_ip_country_name_en === "Lithuania") item.source_ip_country_no = "lt";
                    });
                    return JSON.stringify(data);
                  }
                }

                // 2. Fix Built-in Node Location (/v1/index/map)
                if (this._url.indexOf('/v1/index/map') !== -1) {
                  const data = JSON.parse(originalText);
                  if (data && data.data && data.data.attack_map) {
                    data.data.attack_map.forEach(node => {
                      // Identify the main node (usually "Built-in Nodes" or checks by internal IP)
                      if (node.attacked_client_name.includes("Built-in") || node.country_name === "美国") {
                        node.country_name_en = "Germany";
                        node.country_name = "德国";
                        node.province_name = "Sachsen";
                        node.city_name = "Falkenstein";
                        node.latitude = "50.477";
                        node.longitude = "12.373";
                        node.country_code = "DEU";
                      }
                    });
                    return JSON.stringify(data);
                  }
                }
              } catch (e) {
                // console.warn("Patch error", e);
              }
            }
            return originalText;
          }
        });

        return xhr;
      }

      Object.assign(newXHR, originalXHR);
      newXHR.prototype = originalXHR.prototype;
      window.XMLHttpRequest = newXHR;
      console.log("%c [SecMonitor] API Interceptors Active.", "color: green; font-weight: bold;");
    })();
  </script>
  <script type="text/javascript" defer src="/assets/flags/svgxuse.min.js"></script>
  <script type="text/javascript" src="/assets/dllSelf.09a1636445d39f4f9ec3.js"></script>
  <script type="text/javascript" src="/assets/app.6539b5af.js"></script>
</body>

</html>